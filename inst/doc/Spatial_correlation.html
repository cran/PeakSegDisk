<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title></title>

<script type="text/javascript">
window.onload = function() {
  var imgs = document.getElementsByTagName('img'), i, img;
  for (i = 0; i < imgs.length; i++) {
    img = imgs[i];
    // center an image if it is the only element of its parent
    if (img.parentElement.childElementCount === 1)
      img.parentElement.style.textAlign = 'center';
  }
};
</script>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: #990073
   }

   pre .number {
     color: #099;
   }

   pre .comment {
     color: #998;
     font-style: italic
   }

   pre .keyword {
     color: #900;
     font-weight: bold
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: #d14;
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>



<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 13px;
}

body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 20px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre, img {
  max-width: 100%;
}
pre {
  overflow-x: auto;
}
pre code {
   display: block; padding: 0.5em;
}

code {
  font-size: 92%;
  border: 1px solid #ccc;
}

code[class] {
  background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}
</style>



</head>

<body>
<!--
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{Spatial correlation}
-->

<p>In this vignette we explore to what extent the peak predictions are
sensitive to the spatial correlation in typical genomic data. We also
demonstrate how to efficiently compute coverage profiles from raw
aligned read data using the <code>data.table</code> package.</p>

<p>First we load a data set with one row for every genomic region with a
unique aligned read, and compute mean read size in bases.</p>

<pre><code class="r">library(data.table)
data(ChIPreads, package=&quot;PeakSegDisk&quot;, envir=environment())
(experiments &lt;- ChIPreads[, .(
  mean.bases=mean(chromEnd-chromStart),
  median.bases=median(chromEnd-chromStart),
  chromStart=min(chromStart)
), by=list(experiment)])
#&gt;    experiment mean.bases median.bases chromStart
#&gt; 1:   H3K36me3   93.88568          100  111387372
#&gt; 2:    H3K4me3   95.36224           99  175434087
</code></pre>

<p>From the table above it is clear that the average read size is about
100 for these two experiments.</p>

<p>Below, for each of the two data sets, we compute a data table with two
representations of these aligned reads: count each read at each
aligned base in the read (this induces spatial correlation), or just
the end/last base of the read (this has no spatial correlation).</p>

<pre><code class="r">end.counts &lt;- ChIPreads[, list(
  count=.N #ignores dup reads, sum(count) would not.
), by=list(experiment, chrom, chromEnd)]
(aligned.dt &lt;- rbind(
  ChIPreads[, .(
    bases.counted=&quot;each&quot;, experiment, chrom,
    chromStart, chromEnd,
    count=1)], #ignore duplicate reads.
  end.counts[, .(
    bases.counted=&quot;end&quot;, experiment, chrom,
    chromStart=chromEnd-1L, chromEnd,
    count)]))
#&gt;        bases.counted experiment chrom chromStart  chromEnd count
#&gt;     1:          each   H3K36me3  chr9  111387372 111387472     1
#&gt;     2:          each   H3K36me3  chr9  111387436 111387536     1
#&gt;     3:          each   H3K36me3  chr9  111387443 111387543     1
#&gt;     4:          each   H3K36me3  chr9  111387455 111387554     1
#&gt;     5:          each   H3K36me3  chr9  111387566 111387666     1
#&gt;    ---                                                          
#&gt; 74841:           end    H3K4me3  chr2  175506898 175506899     1
#&gt; 74842:           end    H3K4me3  chr2  175506912 175506913     1
#&gt; 74843:           end    H3K4me3  chr2  175506943 175506944     1
#&gt; 74844:           end    H3K4me3  chr2  175506956 175506957     1
#&gt; 74845:           end    H3K4me3  chr2  175507001 175507002     1
</code></pre>

<p>Each row of the data table above describes how one read should be
counted in order to compute an aligned read profile. </p>

<pre><code class="r">aligned.dt[, {
  as.list(quantile(chromEnd-chromStart))
}, by=.(bases.counted, experiment)]
#&gt;    bases.counted experiment 0% 25% 50% 75% 100%
#&gt; 1:          each   H3K36me3 20  98 100 100  115
#&gt; 2:          each    H3K4me3 20  97  99 100  107
#&gt; 3:           end   H3K36me3  1   1   1   1    1
#&gt; 4:           end    H3K4me3  1   1   1   1    1
</code></pre>

<p>The table above shows that when we only count the end of each base, we
only count the read at one position. When we count the read at each
position, that means from 20 to 115 bases, depending on the read.</p>

<p>Next we compute a count profile for each base in these genomic
regions.</p>

<pre><code class="r">(seq.dt &lt;- aligned.dt[, {
  event.dt &lt;- rbind(
    data.table(count, pos=chromStart+1L),
    data.table(count=-count, pos=chromEnd+1L))
  edge.vec &lt;- event.dt[, {
    as.integer(seq(min(pos), max(pos), l=100))
  }]
  event.bins &lt;- rbind(
    event.dt,
    data.table(count=0L, pos=edge.vec))
  total.dt &lt;- event.bins[, .(
    count=sum(count)
  ), by=list(pos)][order(pos)]
  total.dt[, cum := cumsum(count)]
  total.dt[, bin.i := cumsum(pos %in% edge.vec)]
  ## it is somewhat confusing because total.dt pos is the first base
  ## with cum, and cum goes all the way up to but not including the
  ## pos of the next row.
  total.dt[, data.table(
    chromStart=pos[-.N]-1L,
    chromEnd=pos[-1]-1L,
    count=cum[-.N],
    bin.i=bin.i[-.N])]
}, by=list(bases.counted, experiment, chrom)])
#&gt;         bases.counted experiment chrom chromStart  chromEnd count bin.i
#&gt;      1:          each   H3K36me3  chr9  111387372 111387436     1     1
#&gt;      2:          each   H3K36me3  chr9  111387436 111387443     2     1
#&gt;      3:          each   H3K36me3  chr9  111387443 111387455     3     1
#&gt;      4:          each   H3K36me3  chr9  111387455 111387472     4     1
#&gt;      5:          each   H3K36me3  chr9  111387472 111387536     3     1
#&gt;     ---                                                                
#&gt; 124619:           end    H3K4me3  chr2  175506943 175506944     1    99
#&gt; 124620:           end    H3K4me3  chr2  175506944 175506956     0    99
#&gt; 124621:           end    H3K4me3  chr2  175506956 175506957     1    99
#&gt; 124622:           end    H3K4me3  chr2  175506957 175507001     0    99
#&gt; 124623:           end    H3K4me3  chr2  175507001 175507002     1    99
</code></pre>

<p>In contrast to the previous data tables, the table above contains no
information about individual reads. Each row represents how many
reads, <code>count</code>, have been counted at all positions between
<code>chromStart+1</code> and <code>chromEnd</code>. We plot these aligned read counts
below:</p>

<pre><code class="r">library(ggplot2)
gg.data &lt;- ggplot()+
  theme_bw()+
  theme(panel.spacing=grid::unit(0, &quot;lines&quot;))+
  facet_grid(
    bases.counted ~ experiment,
    scales=&quot;free&quot;,
    labeller=label_both)+
  geom_step(aes(
    chromStart/1e3, count, color=data.type),
    data=data.table(seq.dt, data.type=&quot;exact&quot;))+
  scale_color_manual(values=c(
    exact=&quot;black&quot;,
    bins=&quot;red&quot;,
    model=&quot;deepskyblue&quot;
  ))+
  scale_x_continuous(&quot;Position on hg19 chrom (kb = kilo bases)&quot;)
print(gg.data)
</code></pre>

<p><img src="data:image/png;base64,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" alt="plot of chunk unnamed-chunk-5"/></p>

<p>It is clear from the plot above that, for each experiment (left:H3K36,
right:H3K4), the profiles in the top and bottom plots have peaks in
similar regions.</p>

<p>Next we compute mean profile in bins, using the <code>bin.i</code> column we
created earlier, which assigns each genomic region to one of 99 bins.</p>

<pre><code class="r">bin.dt &lt;- seq.dt[, {
  bases &lt;- chromEnd - chromStart
  data.table(
    binStart=min(chromStart),
    binEnd=max(chromEnd),
    mean.count=sum(count*bases)/sum(bases),
    bases=sum(bases)
  )}, by=list(bases.counted, experiment, bin.i)]
gg.bins &lt;- gg.data+
  geom_step(aes(
    binStart/1e3, mean.count, color=data.type),
    alpha=0.75,
    size=1,
    data=data.table(bin.dt, data.type=&quot;bins&quot;))+
  scale_y_log10(&quot;Aligned DNA sequence reads (log scale)&quot;)
print(gg.bins)
#&gt; Warning: Transformation introduced infinite values in continuous y-axis
#&gt; Warning in grid.Call.graphics(C_lines, x$x, x$y, index, x$arrow): semi-transparency is not supported
#&gt; on this device: reported only once per page
</code></pre>

<p><img src="data:image/png;base64,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" alt="plot of chunk unnamed-chunk-6"/></p>

<p>The mean counts in each bin appear in the plot above as a red line.</p>

<p>Next we compute the optimal segmentation model with 2 peaks for each
data set.</p>

<pre><code class="r">if(interactive() &amp;&amp; requireNamespace(&quot;future&quot;))future::plan(&quot;multiprocess&quot;)
segs.dt &lt;- seq.dt[, {
  data.dir &lt;- file.path(tempdir(), bases.counted, experiment)
  dir.create(data.dir, showWarnings=FALSE, recursive=TRUE)
  coverage.bedGraph &lt;- file.path(data.dir, &quot;coverage.bedGraph&quot;)
  fwrite(
    .SD[, .(chrom, chromStart, chromEnd, count)],
    coverage.bedGraph,
    sep=&quot;\t&quot;,
    quote=FALSE,
    col.names=FALSE)
  fit &lt;- PeakSegDisk::sequentialSearch_dir(data.dir, 2L, verbose=1)
  data.table(fit$segments, data.type=&quot;model&quot;)
}, by=list(bases.counted, experiment)]
#&gt; Next = 0, Inf 
#&gt; Next = 110.889323103247 
#&gt; Next = 1385.23387063487 
#&gt; Next = 25425.6282786644 
#&gt; Next = 373396.954452715 
#&gt; Next = 116338.388376185 
#&gt; Next = 0, Inf 
#&gt; Next = 192.185946075722 
#&gt; Next = 11247.0775923531 
#&gt; Next = 176157.439626319 
#&gt; Next = 0, Inf 
#&gt; Next = 4.37603211086448 
#&gt; Next = 8.94288335356839 
#&gt; Next = 32.2910962473304 
#&gt; Next = 839.262095714024 
#&gt; Next = 0, Inf 
#&gt; Next = 4.20444060519522 
#&gt; Next = 20.44214129621 
#&gt; Next = 618.412457529431
changes.dt &lt;- segs.dt[, {
  .SD[-1]
}, by=list(bases.counted, experiment, data.type)]
gg.model &lt;- gg.bins+
  geom_segment(aes(
    chromStart/1e3, mean,
    xend=chromEnd/1e3, yend=mean,
    color=data.type),
    data=segs.dt)+
  geom_vline(aes(
    xintercept=chromEnd/1e3,
    color=data.type),
    data=changes.dt)
print(gg.model)
#&gt; Warning: Transformation introduced infinite values in continuous y-axis
#&gt; Warning in grid.Call.graphics(C_lines, x$x, x$y, index, x$arrow): semi-transparency is not supported
#&gt; on this device: reported only once per page
</code></pre>

<p><img src="data:image/png;base64,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" alt="plot of chunk unnamed-chunk-7"/></p>

<p>The plot above shows that the predicted peaks (blue) of the models
occur in similar positions, using either the each or end
representations of the data.</p>

<p>Next we compute the difference between predicted peak positions:</p>

<pre><code class="r">peaks.dt &lt;- segs.dt[status==&quot;peak&quot;]
peaks.dt[, peak.i := rep(1:2, l=.N)]
peak.pos.tall &lt;- melt(
  peaks.dt,
  measure.vars=c(&quot;chromStart&quot;, &quot;chromEnd&quot;))
peak.pos.wide &lt;- dcast(
  peak.pos.tall,
  experiment + variable + peak.i ~ bases.counted)
peak.pos.wide[, diff.bases := abs(each-end)]
read.size.panel &lt;- &quot;each&quot;
bases.max.dt &lt;- seq.dt[, .(max.count=max(count)), by=list(bases.counted)]
read.size.y &lt;- bases.max.dt[
  read.size.panel, max.count, on=list(bases.counted)]
diff.panel &lt;- &quot;end&quot;
diff.y &lt;- bases.max.dt[
  diff.panel, max.count, on=list(bases.counted)]
diff.y &lt;- Inf
diff.vjust &lt;- 1.1
gg.model+
  geom_text(aes(
    chromStart/1e3, read.size.y, label=sprintf(
      &quot;Median read size:\n%.0f bases&quot;,
      median.bases)),
    hjust=0,
    vjust=1,
    data=data.table(experiments, bases.counted=read.size.panel))+
  geom_text(aes(
    end/1e3, diff.y,
    label=diff.bases,
    color=data.type),
    data=data.table(
      bases.counted=diff.panel,
      data.type=&quot;model&quot;,
      peak.pos.wide),
    vjust=diff.vjust,
    hjust=0)+
  geom_text(aes(
    chromStart/1e3, diff.y,
    label=&quot;Peak position\ndifference in bases:&quot;,
    color=data.type,
  ),
  hjust=0,
  vjust=diff.vjust,
  data=data.table(
    data.type=&quot;model&quot;,
    bases.counted=diff.panel,
    experiments[&quot;H3K36me3&quot;, on=list(experiment)]))
#&gt; Warning: Transformation introduced infinite values in continuous y-axis
#&gt; Warning in grid.Call.graphics(C_lines, x$x, x$y, index, x$arrow): semi-transparency is not supported
#&gt; on this device: reported only once per page
</code></pre>

<p><img src="data:image/png;base64,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" alt="plot of chunk unnamed-chunk-8"/></p>

<p>In the plot above the blue numbers show the differences (in bases)
between the top and bottom panel peak predictions. It is clear that
the peak predictions are highly consistent between the each/end
representations, with variation on the order of read size (100 bases).</p>

<p>Overall these results indicate that the peak detection algorithm is
highly robust to the spatial correlation that is present in typical
ChIP-seq coverage profile data.</p>

</body>

</html>
